!function(e){"use strict";class ProductionCollectionHelper{constructor(e={}){this.cache=new Map,this.weakCache=new WeakMap,this.options={enableLogging:e.enableLogging??!1,autoCleanup:e.autoCleanup??!0,cleanupInterval:e.cleanupInterval??3e4,maxCacheSize:e.maxCacheSize??1e3,debounceDelay:e.debounceDelay??16,...e},this.stats={hits:0,misses:0,cacheSize:0,lastCleanup:Date.now()},this.pendingUpdates=new Set,this.cleanupTimer=null,this.isDestroyed=!1,this._initProxies(),this._initMutationObserver(),this._scheduleCleanup()}_initProxies(){this.ClassName=new Proxy(this,{get:(e,t)=>"symbol"==typeof t||"function"==typeof e[t]?e[t]:e._getCollection("className",t)}),this.TagName=new Proxy(this,{get:(e,t)=>"symbol"==typeof t||"function"==typeof e[t]?e[t]:e._getCollection("tagName",t)}),this.Name=new Proxy(this,{get:(e,t)=>"symbol"==typeof t||"function"==typeof e[t]?e[t]:e._getCollection("name",t)})}_createCacheKey(e,t){return`${e}:${t}`}_getCollection(e,t){if("string"!=typeof t)return this._warn(`Invalid ${e} property type: ${typeof t}`),this._createEmptyCollection();const a=this._createCacheKey(e,t);if(this.cache.has(a)){const e=this.cache.get(a);if(this._isValidCollection(e))return this.stats.hits++,e;this.cache.delete(a)}let s;switch(e){case"className":s=document.getElementsByClassName(t);break;case"tagName":s=document.getElementsByTagName(t);break;case"name":s=document.getElementsByName(t);break;default:return this._warn(`Unknown collection type: ${e}`),this._createEmptyCollection()}const i=this._enhanceCollection(s,e,t);return this._addToCache(a,i),this.stats.misses++,i}_isValidCollection(e){if(!e||!e._originalCollection)return!1;const t=e._originalCollection;if(0===t.length)return!0;const a=t[0];return a&&document.contains(a)}_enhanceCollection(e,t,a){const s={_originalCollection:e,_type:t,_value:a,_cachedAt:Date.now(),get length(){return e.length},item:t=>e.item(t),namedItem:t=>e.namedItem?e.namedItem(t):null,toArray:()=>Array.from(e),forEach(t,a){Array.from(e).forEach(t,a)},map:(t,a)=>Array.from(e).map(t,a),filter:(t,a)=>Array.from(e).filter(t,a),find:(t,a)=>Array.from(e).find(t,a),some:(t,a)=>Array.from(e).some(t,a),every:(t,a)=>Array.from(e).every(t,a),first:()=>e.length>0?e[0]:null,last:()=>e.length>0?e[e.length-1]:null,at:t=>(t<0&&(t=e.length+t),t>=0&&t<e.length?e[t]:null),isEmpty:()=>0===e.length};for(let t=0;t<e.length;t++)Object.defineProperty(s,t,{get:()=>e[t],enumerable:!0});return s[Symbol.iterator]=function*(){for(let t=0;t<e.length;t++)yield e[t]},s}_createEmptyCollection(){return this._enhanceCollection({length:0,item:()=>null,namedItem:()=>null},"empty","")}_addToCache(e,t){if(this.cache.size>=this.options.maxCacheSize){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t),this.stats.cacheSize=this.cache.size,this.weakCache.set(t,{cacheKey:e,cachedAt:Date.now(),accessCount:1})}_initMutationObserver(){const e=this._debounce(e=>{this._processMutations(e)},this.options.debounceDelay);this.observer=new MutationObserver(e),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","name"]})}_processMutations(e){if(this.isDestroyed)return;const t=new Set,a=new Set,s=new Set;e.forEach(e=>{if([...e.addedNodes,...e.removedNodes].forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(e.className&&e.className.split(/\s+/).forEach(e=>{e&&t.add(e)}),e.name&&a.add(e.name),s.add(e.tagName.toLowerCase()),(e.querySelectorAll?e.querySelectorAll("*"):[]).forEach(e=>{e.className&&e.className.split(/\s+/).forEach(e=>{e&&t.add(e)}),e.name&&a.add(e.name),s.add(e.tagName.toLowerCase())}))}),"attributes"===e.type){const s=e.target;"class"===e.attributeName&&[...e.oldValue?e.oldValue.split(/\s+/):[],...s.className?s.className.split(/\s+/):[]].forEach(e=>{e&&t.add(e)}),"name"===e.attributeName&&(e.oldValue&&a.add(e.oldValue),s.name&&a.add(s.name))}});const i=[];for(const e of this.cache.keys()){const[n,o]=e.split(":",2);("className"===n&&t.has(o)||"name"===n&&a.has(o)||"tagName"===n&&s.has(o))&&i.push(e)}i.forEach(e=>this.cache.delete(e)),this.stats.cacheSize=this.cache.size,i.length>0&&this._log(`Invalidated ${i.length} cache entries due to DOM changes`)}_scheduleCleanup(){this.options.autoCleanup&&!this.isDestroyed&&(this.cleanupTimer=setTimeout(()=>{this._performCleanup(),this._scheduleCleanup()},this.options.cleanupInterval))}_performCleanup(){if(this.isDestroyed)return;const e=this.cache.size,t=[];for(const[e,a]of this.cache)this._isValidCollection(a)||t.push(e);t.forEach(e=>this.cache.delete(e)),this.stats.cacheSize=this.cache.size,this.stats.lastCleanup=Date.now(),this._log(`Cleanup completed. Removed ${e-this.cache.size} stale entries.`)}_debounce(e,t){let a;return(...s)=>{clearTimeout(a),a=setTimeout(()=>e.apply(this,s),t)}}_log(e){this.options.enableLogging&&console.log(`[Collections] ${e}`)}_warn(e){this.options.enableLogging&&console.warn(`[Collections] ${e}`)}getStats(){return{...this.stats,hitRate:this.stats.hits/(this.stats.hits+this.stats.misses)||0,uptime:Date.now()-this.stats.lastCleanup}}clearCache(){this.cache.clear(),this.stats.cacheSize=0,this._log("Cache cleared manually")}destroy(){this.isDestroyed=!0,this.observer&&(this.observer.disconnect(),this.observer=null),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=null),this.cache.clear(),this._log("Collections helper destroyed")}isCached(e,t){return this.cache.has(this._createCacheKey(e,t))}getCacheSnapshot(){return Array.from(this.cache.keys())}getMultiple(e){const t={};return e.forEach(({type:e,value:a,as:s})=>{const i=s||`${e}_${a}`;switch(e){case"className":t[i]=this.ClassName[a];break;case"tagName":t[i]=this.TagName[a];break;case"name":t[i]=this.Name[a]}}),t}async waitForElements(e,t,a=1,s=5e3){const i=Date.now();for(;Date.now()-i<s;){let s;switch(e){case"className":s=this.ClassName[t];break;case"tagName":s=this.TagName[t];break;case"name":s=this.Name[t];break;default:throw new Error(`Unknown collection type: ${e}`)}if(s&&s.length>=a)return s;await new Promise(e=>setTimeout(e,100))}throw new Error(`Timeout waiting for ${e}="${t}" (min: ${a})`)}}const t=new ProductionCollectionHelper({enableLogging:!1,autoCleanup:!0,cleanupInterval:3e4,maxCacheSize:1e3}),Collections={ClassName:t.ClassName,TagName:t.TagName,Name:t.Name,helper:t,stats:()=>t.getStats(),clear:()=>t.clearCache(),destroy:()=>t.destroy(),isCached:(e,a)=>t.isCached(e,a),getMultiple:e=>t.getMultiple(e),waitFor:(e,a,s,i)=>t.waitForElements(e,a,s,i),configure:e=>(Object.assign(t.options,e),Collections)};"undefined"!=typeof module&&module.exports?module.exports={Collections:Collections,ProductionCollectionHelper:ProductionCollectionHelper}:"function"==typeof define&&define.amd?define([],function(){return{Collections:Collections,ProductionCollectionHelper:ProductionCollectionHelper}}):(e.Collections=Collections,e.ProductionCollectionHelper=ProductionCollectionHelper),"undefined"!=typeof window&&window.addEventListener("beforeunload",()=>{t.destroy()})}("undefined"!=typeof window?window:"undefined"!=typeof global?global:this);