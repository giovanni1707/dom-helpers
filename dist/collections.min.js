!function(e){"use strict";let t;if("undefined"!=typeof require)try{t=require("./enhanced-update-utility.js")}catch(e){}else void 0!==e&&e.EnhancedUpdateUtility&&(t=e.EnhancedUpdateUtility);class ProductionCollectionHelper{constructor(e={}){this.cache=new Map,this.weakCache=new WeakMap,this.options={enableLogging:e.enableLogging??!1,autoCleanup:e.autoCleanup??!0,cleanupInterval:e.cleanupInterval??3e4,maxCacheSize:e.maxCacheSize??1e3,debounceDelay:e.debounceDelay??16,enableEnhancedSyntax:e.enableEnhancedSyntax??!0,...e},this.stats={hits:0,misses:0,cacheSize:0,lastCleanup:Date.now()},this.pendingUpdates=new Set,this.cleanupTimer=null,this.isDestroyed=!1,this._initProxies(),this._initMutationObserver(),this._scheduleCleanup()}_initProxies(){this.ClassName=this._createCollectionProxy("className"),this.TagName=this._createCollectionProxy("tagName"),this.Name=this._createCollectionProxy("name")}_createCollectionProxy(e){return new Proxy(t=>{const a=this._getCollection(e,t);return this.options.enableEnhancedSyntax?this._createEnhancedCollectionProxy(a):a},{get:(t,a)=>{if("symbol"==typeof a||"constructor"===a||"prototype"===a||"apply"===a||"call"===a||"bind"===a||"function"==typeof t[a])return t[a];const n=this._getCollection(e,a);return this.options.enableEnhancedSyntax?this._createEnhancedCollectionProxy(n):n},apply:(e,t,a)=>a.length>0?e(a[0]):this._createEmptyCollection()})}_createEnhancedCollectionProxy(e){return e&&this.options.enableEnhancedSyntax?new Proxy(e,{get:(e,t)=>{if(!isNaN(t)&&parseInt(t)>=0){const a=e[parseInt(t)];return a?this._createElementProxy(a):a}return e[t]},set:(e,t,a)=>{try{return e[t]=a,!0}catch(e){return this._warn(`Failed to set collection property ${t}: ${e.message}`),!1}}}):e}_createElementProxy(e){return e&&this.options.enableEnhancedSyntax?new Proxy(e,{get:(e,t)=>e[t],set:(e,t,a)=>{try{return e[t]=a,!0}catch(e){return this._warn(`Failed to set element property ${t}: ${e.message}`),!1}}}):e}_createCacheKey(e,t){return`${e}:${t}`}_getCollection(e,t){if("string"!=typeof t)return this._warn(`Invalid ${e} property type: ${typeof t}`),this._createEmptyCollection();const a=this._createCacheKey(e,t);if(this.cache.has(a)){const e=this.cache.get(a);if(this._isValidCollection(e))return this.stats.hits++,e;this.cache.delete(a)}let n;try{switch(e){case"className":n=document.getElementsByClassName(t);break;case"tagName":n=document.getElementsByTagName(t);break;case"name":n=document.getElementsByName(t);break;default:return this._warn(`Unknown collection type: ${e}`),this._createEmptyCollection()}}catch(a){return this._warn(`Error getting ${e} collection for "${t}": ${a.message}`),this._createEmptyCollection()}const s=this._enhanceCollection(n,e,t);return this._addToCache(a,s),this.stats.misses++,s}_isValidCollection(e){if(!e||!e._originalCollection)return!1;const t=e._originalCollection;if(0===t.length)return!0;const a=t[0];return a&&a.nodeType===Node.ELEMENT_NODE&&document.contains(a)}_enhanceCollection(e,t,a){const n={_originalCollection:e,_type:t,_value:a,_cachedAt:Date.now(),get length(){return e.length},item:t=>e.item(t),namedItem:t=>e.namedItem?e.namedItem(t):null,toArray:()=>Array.from(e),forEach(t,a){Array.from(e).forEach(t,a)},map:(t,a)=>Array.from(e).map(t,a),filter:(t,a)=>Array.from(e).filter(t,a),find:(t,a)=>Array.from(e).find(t,a),some:(t,a)=>Array.from(e).some(t,a),every:(t,a)=>Array.from(e).every(t,a),reduce:(t,a)=>Array.from(e).reduce(t,a),first:()=>e.length>0?e[0]:null,last:()=>e.length>0?e[e.length-1]:null,at:t=>(t<0&&(t=e.length+t),t>=0&&t<e.length?e[t]:null),isEmpty:()=>0===e.length,addClass(e){return this.forEach(t=>t.classList.add(e)),this},removeClass(e){return this.forEach(t=>t.classList.remove(e)),this},toggleClass(e){return this.forEach(t=>t.classList.toggle(e)),this},setProperty(e,t){return this.forEach(a=>a[e]=t),this},setAttribute(e,t){return this.forEach(a=>a.setAttribute(e,t)),this},setStyle(e){return this.forEach(t=>{Object.assign(t.style,e)}),this},on(e,t){return this.forEach(a=>a.addEventListener(e,t)),this},off(e,t){return this.forEach(a=>a.removeEventListener(e,t)),this},visible(){return this.filter(e=>{const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity})},hidden(){return this.filter(e=>{const t=window.getComputedStyle(e);return"none"===t.display||"hidden"===t.visibility||"0"===t.opacity})},enabled(){return this.filter(e=>!e.disabled&&!e.hasAttribute("disabled"))},disabled(){return this.filter(e=>e.disabled||e.hasAttribute("disabled"))}};for(let t=0;t<e.length;t++)Object.defineProperty(n,t,{get:()=>e[t],enumerable:!0});return n[Symbol.iterator]=function*(){for(let t=0;t<e.length;t++)yield e[t]},this._enhanceCollectionWithUpdate(n)}_createEmptyCollection(){return this._enhanceCollection({length:0,item:()=>null,namedItem:()=>null},"empty","")}_addToCache(e,t){if(this.cache.size>=this.options.maxCacheSize){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t),this.stats.cacheSize=this.cache.size,this.weakCache.set(t,{cacheKey:e,cachedAt:Date.now(),accessCount:1})}_initMutationObserver(){const e=this._debounce(e=>{this._processMutations(e)},this.options.debounceDelay);this.observer=new MutationObserver(e),document.body?this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","name"],attributeOldValue:!0}):document.addEventListener("DOMContentLoaded",()=>{document.body&&!this.isDestroyed&&this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","name"],attributeOldValue:!0})})}_processMutations(e){if(this.isDestroyed)return;const t=new Set,a=new Set,n=new Set;e.forEach(e=>{if([...e.addedNodes,...e.removedNodes].forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){e.className&&e.className.split(/\s+/).forEach(e=>{e&&t.add(e)}),e.name&&a.add(e.name),n.add(e.tagName.toLowerCase());try{(e.querySelectorAll?e.querySelectorAll("*"):[]).forEach(e=>{e.className&&e.className.split(/\s+/).forEach(e=>{e&&t.add(e)}),e.name&&a.add(e.name),n.add(e.tagName.toLowerCase())})}catch(e){}}}),"attributes"===e.type){const n=e.target;"class"===e.attributeName&&[...e.oldValue?e.oldValue.split(/\s+/):[],...n.className?n.className.split(/\s+/):[]].forEach(e=>{e&&t.add(e)}),"name"===e.attributeName&&(e.oldValue&&a.add(e.oldValue),n.name&&a.add(n.name))}});const s=[];for(const e of this.cache.keys()){const[r,i]=e.split(":",2);("className"===r&&t.has(i)||"name"===r&&a.has(i)||"tagName"===r&&n.has(i))&&s.push(e)}s.forEach(e=>this.cache.delete(e)),this.stats.cacheSize=this.cache.size,s.length>0&&this.options.enableLogging&&this._log(`Invalidated ${s.length} cache entries due to DOM changes`)}_scheduleCleanup(){this.options.autoCleanup&&!this.isDestroyed&&(this.cleanupTimer=setTimeout(()=>{this._performCleanup(),this._scheduleCleanup()},this.options.cleanupInterval))}_performCleanup(){if(this.isDestroyed)return;this.cache.size;const e=[];for(const[t,a]of this.cache)this._isValidCollection(a)||e.push(t);e.forEach(e=>this.cache.delete(e)),this.stats.cacheSize=this.cache.size,this.stats.lastCleanup=Date.now(),this.options.enableLogging&&e.length>0&&this._log(`Cleanup completed. Removed ${e.length} stale entries.`)}_debounce(e,t){let a;return(...n)=>{clearTimeout(a),a=setTimeout(()=>e.apply(this,n),t)}}_log(e){this.options.enableLogging&&console.log(`[Collections] ${e}`)}_warn(e){this.options.enableLogging&&console.warn(`[Collections] ${e}`)}_applyEnhancedUpdateToElement(e,t,a){try{if("style"===t&&"object"==typeof a&&null!==a)return void Object.entries(a).forEach(([t,a])=>{null!=a&&(e.style[t]=a)});if("classList"===t&&"object"==typeof a&&null!==a)return void this._handleClassListUpdate(e,a);if("setAttribute"===t&&Array.isArray(a)&&a.length>=2)return void e.setAttribute(a[0],a[1]);if("removeAttribute"===t)return void(Array.isArray(a)?a.forEach(t=>e.removeAttribute(t)):"string"==typeof a&&e.removeAttribute(a));if("addEventListener"===t&&Array.isArray(a)&&a.length>=2){const[t,n,s]=a;return void e.addEventListener(t,n,s)}if("removeEventListener"===t&&Array.isArray(a)&&a.length>=2){const[t,n,s]=a;return void e.removeEventListener(t,n,s)}if("dataset"===t&&"object"==typeof a&&null!==a)return void Object.entries(a).forEach(([t,a])=>{e.dataset[t]=a});if("function"==typeof e[t])return void(Array.isArray(a)?e[t](...a):e[t](a));if(t in e)return void(e[t]=a);if("string"==typeof a||"number"==typeof a||"boolean"==typeof a)return void e.setAttribute(t,a);console.warn(`[DOM Helpers] Unknown property or method: ${t}`)}catch(e){console.warn(`[DOM Helpers] Failed to apply update ${t}: ${e.message}`)}}_handleClassListUpdate(e,t){Object.entries(t).forEach(([t,a])=>{try{switch(t){case"add":Array.isArray(a)?e.classList.add(...a):"string"==typeof a&&e.classList.add(a);break;case"remove":Array.isArray(a)?e.classList.remove(...a):"string"==typeof a&&e.classList.remove(a);break;case"toggle":Array.isArray(a)?a.forEach(t=>e.classList.toggle(t)):"string"==typeof a&&e.classList.toggle(a);break;case"replace":Array.isArray(a)&&2===a.length&&e.classList.replace(a[0],a[1]);break;case"contains":Array.isArray(a)?a.forEach(t=>{console.log(`[DOM Helpers] classList.contains('${t}'):`,e.classList.contains(t))}):"string"==typeof a&&console.log(`[DOM Helpers] classList.contains('${a}'):`,e.classList.contains(a));break;default:console.warn(`[DOM Helpers] Unknown classList method: ${t}`)}}catch(e){console.warn(`[DOM Helpers] Error in classList.${t}: ${e.message}`)}})}_enhanceCollectionWithUpdate(e){if(!e||e._hasEnhancedUpdateMethod)return e;if(t&&t.enhanceCollectionWithUpdate)return t.enhanceCollectionWithUpdate(e);try{Object.defineProperty(e,"update",{value:(t={})=>{if(!t||"object"!=typeof t)return console.warn("[DOM Helpers] .update() called with invalid updates object"),e;let a=[];if(e._originalCollection?a=Array.from(e._originalCollection):void 0!==e.length&&(a=Array.from(e)),0===a.length)return console.info("[DOM Helpers] .update() called on empty collection"),e;try{a.forEach(e=>{e&&e.nodeType===Node.ELEMENT_NODE&&Object.entries(t).forEach(([t,a])=>{this._applyEnhancedUpdateToElement(e,t,a)})})}catch(e){console.warn(`[DOM Helpers] Error in collection .update(): ${e.message}`)}return e},writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(e,"_hasEnhancedUpdateMethod",{value:!0,writable:!1,enumerable:!1,configurable:!1})}catch(t){e.update=(t={})=>{if(!t||"object"!=typeof t)return console.warn("[DOM Helpers] .update() called with invalid updates object"),e;let a=[];if(e._originalCollection?a=Array.from(e._originalCollection):void 0!==e.length&&(a=Array.from(e)),0===a.length)return console.info("[DOM Helpers] .update() called on empty collection"),e;try{a.forEach(e=>{e&&e.nodeType===Node.ELEMENT_NODE&&Object.entries(t).forEach(([t,a])=>{this._applyEnhancedUpdateToElement(e,t,a)})})}catch(e){console.warn(`[DOM Helpers] Error in collection .update(): ${e.message}`)}return e},e._hasEnhancedUpdateMethod=!0}return e}getStats(){return{...this.stats,hitRate:this.stats.hits/(this.stats.hits+this.stats.misses)||0,uptime:Date.now()-this.stats.lastCleanup}}clearCache(){this.cache.clear(),this.stats.cacheSize=0,this._log("Cache cleared manually")}destroy(){this.isDestroyed=!0,this.observer&&(this.observer.disconnect(),this.observer=null),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=null),this.cache.clear(),this._log("Collections helper destroyed")}isCached(e,t){return this.cache.has(this._createCacheKey(e,t))}getCacheSnapshot(){return Array.from(this.cache.keys())}getMultiple(e){const t={};return e.forEach(({type:e,value:a,as:n})=>{const s=n||`${e}_${a}`;switch(e){case"className":t[s]=this.ClassName[a];break;case"tagName":t[s]=this.TagName[a];break;case"name":t[s]=this.Name[a]}}),t}async waitForElements(e,t,a=1,n=5e3){const s=Date.now();for(;Date.now()-s<n;){let n;switch(e){case"className":n=this.ClassName[t];break;case"tagName":n=this.TagName[t];break;case"name":n=this.Name[t];break;default:throw new Error(`Unknown collection type: ${e}`)}if(n&&n.length>=a)return n;await new Promise(e=>setTimeout(e,100))}throw new Error(`Timeout waiting for ${e}="${t}" (min: ${a})`)}enableEnhancedSyntax(){return this.options.enableEnhancedSyntax=!0,this}disableEnhancedSyntax(){return this.options.enableEnhancedSyntax=!1,this}}const a=new ProductionCollectionHelper({enableLogging:!1,autoCleanup:!0,cleanupInterval:3e4,maxCacheSize:1e3,enableEnhancedSyntax:!0}),Collections={ClassName:a.ClassName,TagName:a.TagName,Name:a.Name,helper:a,stats:()=>a.getStats(),clear:()=>a.clearCache(),destroy:()=>a.destroy(),isCached:(e,t)=>a.isCached(e,t),getMultiple:e=>a.getMultiple(e),waitFor:(e,t,n,s)=>a.waitForElements(e,t,n,s),enableEnhancedSyntax:()=>a.enableEnhancedSyntax(),disableEnhancedSyntax:()=>a.disableEnhancedSyntax(),configure:e=>(Object.assign(a.options,e),Collections)};"undefined"!=typeof module&&module.exports?module.exports={Collections:Collections,ProductionCollectionHelper:ProductionCollectionHelper}:"function"==typeof define&&define.amd?define([],function(){return{Collections:Collections,ProductionCollectionHelper:ProductionCollectionHelper}}):(e.Collections=Collections,e.ProductionCollectionHelper=ProductionCollectionHelper),"undefined"!=typeof window&&window.addEventListener("beforeunload",()=>{a.destroy()})}("undefined"!=typeof window?window:"undefined"!=typeof global?global:this);