!function(e){"use strict";class ProductionSelectorHelper{constructor(e={}){this.cache=new Map,this.weakCache=new WeakMap,this.options={enableLogging:e.enableLogging??!1,autoCleanup:e.autoCleanup??!0,cleanupInterval:e.cleanupInterval??3e4,maxCacheSize:e.maxCacheSize??1e3,debounceDelay:e.debounceDelay??16,enableSmartCaching:e.enableSmartCaching??!0,...e},this.stats={hits:0,misses:0,cacheSize:0,lastCleanup:Date.now(),selectorTypes:new Map},this.pendingUpdates=new Set,this.cleanupTimer=null,this.isDestroyed=!1,this.selectorPatterns=this._buildSelectorPatterns(),this._initProxies(),this._initMutationObserver(),this._scheduleCleanup()}_buildSelectorPatterns(){return{id:/^#([a-zA-Z][\w-]*)$/,class:/^\.([a-zA-Z][\w-]*)$/,tag:/^([a-zA-Z][a-zA-Z0-9]*)$/,attribute:/^\[([^\]]+)\]$/,descendant:/^(\w+)\s+(\w+)$/,child:/^(\w+)\s*>\s*(\w+)$/,pseudo:/^(\w+):([a-zA-Z-]+)$/}}_initProxies(){this.query=new Proxy(this._createQueryFunction("single"),{get:(e,t)=>{if("symbol"==typeof t||"constructor"===t||"prototype"===t||"function"==typeof e[t])return e[t];const s=this._normalizeSelector(t);return this._getQuery("single",s)},apply:(e,t,s)=>s.length>0?this._getQuery("single",s[0]):null}),this.queryAll=new Proxy(this._createQueryFunction("multiple"),{get:(e,t)=>{if("symbol"==typeof t||"constructor"===t||"prototype"===t||"function"==typeof e[t])return e[t];const s=this._normalizeSelector(t);return this._getQuery("multiple",s)},apply:(e,t,s)=>s.length>0?this._getQuery("multiple",s[0]):this._createEmptyCollection()}),this.Scoped={within:(e,t)=>{const s="string"==typeof e?document.querySelector(e):e;if(!s)return null;const i=`scoped:${s.id||"anonymous"}:${t}`;return this._getScopedQuery(s,t,"single",i)},withinAll:(e,t)=>{const s="string"==typeof e?document.querySelector(e):e;if(!s)return this._createEmptyCollection();const i=`scopedAll:${s.id||"anonymous"}:${t}`;return this._getScopedQuery(s,t,"multiple",i)}}}_createQueryFunction(e){const t=t=>this._getQuery(e,t);return t._queryType=e,t._helper=this,t}_normalizeSelector(e){const t=e.toString(),s=e=>`.${this._camelToKebab(e)}`;return t.startsWith("id")&&t.length>2?(e=>`#${this._camelToKebab(e)}`)(t.slice(2)):t.startsWith("class")&&t.length>5?s(t.slice(5)):/^[a-z][a-zA-Z]*$/.test(t)&&/[A-Z]/.test(t)?s(t):(/^[a-z]+$/.test(t)&&t.length,t)}_camelToKebab(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}_createCacheKey(e,t){return`${e}:${t}`}_getQuery(e,t){if("string"!=typeof t)return this._warn("Invalid selector type: "+typeof t),"single"===e?null:this._createEmptyCollection();const s=this._createCacheKey(e,t);if(this.cache.has(s)){const i=this.cache.get(s);if(this._isValidQuery(i,e))return this.stats.hits++,this._trackSelectorType(t),i;this.cache.delete(s)}let i;try{if("single"===e)i=document.querySelector(t);else{const e=document.querySelectorAll(t);i=this._enhanceNodeList(e,t)}}catch(s){return this._warn(`Invalid selector "${t}": ${s.message}`),"single"===e?null:this._createEmptyCollection()}return this._addToCache(s,i),this.stats.misses++,this._trackSelectorType(t),i}_getScopedQuery(e,t,s,i){if(this.cache.has(i)){const e=this.cache.get(i);if(this._isValidQuery(e,s))return this.stats.hits++,e;this.cache.delete(i)}let r;try{if("single"===s)r=e.querySelector(t);else{const s=e.querySelectorAll(t);r=this._enhanceNodeList(s,t)}}catch(e){return this._warn(`Invalid scoped selector "${t}": ${e.message}`),"single"===s?null:this._createEmptyCollection()}return this._addToCache(i,r),this.stats.misses++,r}_isValidQuery(e,t){if("single"===t)return e&&e.nodeType===Node.ELEMENT_NODE&&document.contains(e);{if(!e||!e._originalNodeList)return!1;const t=e._originalNodeList;if(0===t.length)return!0;const s=t[0];return s&&document.contains(s)}}_enhanceNodeList(e,t){const s={_originalNodeList:e,_selector:t,_cachedAt:Date.now(),get length(){return e.length},item:t=>e.item(t),entries:()=>e.entries(),keys:()=>e.keys(),values:()=>e.values(),toArray:()=>Array.from(e),forEach(t,s){e.forEach(t,s)},map:(t,s)=>Array.from(e).map(t,s),filter:(t,s)=>Array.from(e).filter(t,s),find:(t,s)=>Array.from(e).find(t,s),some:(t,s)=>Array.from(e).some(t,s),every:(t,s)=>Array.from(e).every(t,s),reduce:(t,s)=>Array.from(e).reduce(t,s),first:()=>e.length>0?e[0]:null,last:()=>e.length>0?e[e.length-1]:null,at:t=>(t<0&&(t=e.length+t),t>=0&&t<e.length?e[t]:null),isEmpty:()=>0===e.length,addClass(e){return this.forEach(t=>t.classList.add(e)),this},removeClass(e){return this.forEach(t=>t.classList.remove(e)),this},toggleClass(e){return this.forEach(t=>t.classList.toggle(e)),this},setProperty(e,t){return this.forEach(s=>s[e]=t),this},setAttribute(e,t){return this.forEach(s=>s.setAttribute(e,t)),this},setStyle(e){return this.forEach(t=>{Object.assign(t.style,e)}),this},on(e,t){return this.forEach(s=>s.addEventListener(e,t)),this},off(e,t){return this.forEach(s=>s.removeEventListener(e,t)),this},visible(){return this.filter(e=>{const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity})},hidden(){return this.filter(e=>{const t=window.getComputedStyle(e);return"none"===t.display||"hidden"===t.visibility||"0"===t.opacity})},enabled(){return this.filter(e=>!e.disabled&&!e.hasAttribute("disabled"))},disabled(){return this.filter(e=>e.disabled||e.hasAttribute("disabled"))},within(e){const t=[];return this.forEach(s=>{const i=s.querySelectorAll(e);t.push(...Array.from(i))}),this._helper._enhanceNodeList(t,`${this._selector} ${e}`)}};for(let t=0;t<e.length;t++)Object.defineProperty(s,t,{get:()=>e[t],enumerable:!0});return s[Symbol.iterator]=function*(){for(let t=0;t<e.length;t++)yield e[t]},s}_createEmptyCollection(){const e=document.querySelectorAll("nonexistent-element-that-never-exists");return this._enhanceNodeList(e,"empty")}_trackSelectorType(e){const t=this._classifySelector(e),s=this.stats.selectorTypes.get(t)||0;this.stats.selectorTypes.set(t,s+1)}_classifySelector(e){return this.selectorPatterns.id.test(e)?"id":this.selectorPatterns.class.test(e)?"class":this.selectorPatterns.tag.test(e)?"tag":this.selectorPatterns.attribute.test(e)?"attribute":this.selectorPatterns.descendant.test(e)?"descendant":this.selectorPatterns.child.test(e)?"child":this.selectorPatterns.pseudo.test(e)?"pseudo":"complex"}_addToCache(e,t){if(this.cache.size>=this.options.maxCacheSize){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t),this.stats.cacheSize=this.cache.size,t&&t.nodeType===Node.ELEMENT_NODE&&this.weakCache.set(t,{cacheKey:e,cachedAt:Date.now(),accessCount:1})}_initMutationObserver(){if(!this.options.enableSmartCaching)return;const e=this._debounce(e=>{this._processMutations(e)},this.options.debounceDelay);this.observer=new MutationObserver(e),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["id","class","style","hidden","disabled"]})}_processMutations(e){if(this.isDestroyed)return;const t=new Set;if(e.forEach(e=>{if("childList"===e.type&&t.add("*"),"attributes"===e.type){const s=e.target,i=e.attributeName;"id"===i&&(t.add(`#${e.oldValue}`),s.id&&t.add(`#${s.id}`)),"class"===i&&[...e.oldValue?e.oldValue.split(/\s+/):[],...s.className?s.className.split(/\s+/):[]].forEach(e=>{e&&t.add(`.${e}`)}),t.add(`[${i}]`)}}),t.has("*"))this.cache.clear();else{const e=[];for(const s of this.cache.keys()){const[i,r]=s.split(":",2);for(const i of t)if(r.includes(i)){e.push(s);break}}e.forEach(e=>this.cache.delete(e))}this.stats.cacheSize=this.cache.size}_scheduleCleanup(){this.options.autoCleanup&&!this.isDestroyed&&(this.cleanupTimer=setTimeout(()=>{this._performCleanup(),this._scheduleCleanup()},this.options.cleanupInterval))}_performCleanup(){if(this.isDestroyed)return;const e=this.cache.size,t=[];for(const[e,s]of this.cache){const[i]=e.split(":",1);this._isValidQuery(s,"single"===i?"single":"multiple")||t.push(e)}t.forEach(e=>this.cache.delete(e)),this.stats.cacheSize=this.cache.size,this.stats.lastCleanup=Date.now(),this._log(`Cleanup completed. Removed ${e-this.cache.size} stale entries.`)}_debounce(e,t){let s;return(...i)=>{clearTimeout(s),s=setTimeout(()=>e.apply(this,i),t)}}_log(e){this.options.enableLogging&&console.log(`[Selector] ${e}`)}_warn(e){this.options.enableLogging&&console.warn(`[Selector] ${e}`)}getStats(){return{...this.stats,hitRate:this.stats.hits/(this.stats.hits+this.stats.misses)||0,uptime:Date.now()-this.stats.lastCleanup,selectorBreakdown:Object.fromEntries(this.stats.selectorTypes)}}clearCache(){this.cache.clear(),this.stats.cacheSize=0,this.stats.selectorTypes.clear(),this._log("Cache cleared manually")}destroy(){this.isDestroyed=!0,this.observer&&(this.observer.disconnect(),this.observer=null),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=null),this.cache.clear(),this._log("Selector helper destroyed")}async waitForSelector(e,t=5e3){const s=Date.now();for(;Date.now()-s<t;){const t=this.query(e);if(t)return t;await new Promise(e=>setTimeout(e,100))}throw new Error(`Timeout waiting for selector: ${e}`)}async waitForSelectorAll(e,t=1,s=5e3){const i=Date.now();for(;Date.now()-i<s;){const s=this.queryAll(e);if(s&&s.length>=t)return s;await new Promise(e=>setTimeout(e,100))}throw new Error(`Timeout waiting for selector: ${e} (min: ${t})`)}}const t=new ProductionSelectorHelper({enableLogging:!1,autoCleanup:!0,cleanupInterval:3e4,maxCacheSize:1e3,enableSmartCaching:!0}),Selector={query:t.query,queryAll:t.queryAll,Scoped:t.Scoped,helper:t,stats:()=>t.getStats(),clear:()=>t.clearCache(),destroy:()=>t.destroy(),waitFor:(e,s)=>t.waitForSelector(e,s),waitForAll:(e,s,i)=>t.waitForSelectorAll(e,s,i),configure:e=>(Object.assign(t.options,e),Selector)};"undefined"!=typeof module&&module.exports?module.exports={Selector:Selector,ProductionSelectorHelper:ProductionSelectorHelper}:"function"==typeof define&&define.amd?define([],function(){return{Selector:Selector,ProductionSelectorHelper:ProductionSelectorHelper}}):(e.Selector=Selector,e.ProductionSelectorHelper=ProductionSelectorHelper),"undefined"!=typeof window&&window.addEventListener("beforeunload",()=>{t.destroy()})}("undefined"!=typeof window?window:"undefined"!=typeof global?global:this);