!function(e){"use strict";let t;if("undefined"!=typeof require)try{t=require("./update-utility.js")}catch(e){}else void 0!==e&&e.UpdateUtility&&(t=e.UpdateUtility);class ProductionElementsHelper{constructor(e={}){this.cache=new Map,this.weakCache=new WeakMap,this.options={enableLogging:e.enableLogging??!1,autoCleanup:e.autoCleanup??!0,cleanupInterval:e.cleanupInterval??3e4,maxCacheSize:e.maxCacheSize??1e3,debounceDelay:e.debounceDelay??16,...e},this.stats={hits:0,misses:0,cacheSize:0,lastCleanup:Date.now()},this.pendingUpdates=new Set,this.cleanupTimer=null,this.isDestroyed=!1,this._initProxy(),this._initMutationObserver(),this._scheduleCleanup()}_initProxy(){this.Elements=new Proxy(this,{get:(e,t)=>"symbol"==typeof t||t.startsWith("_")||"function"==typeof e[t]?e[t]:e._getElement(t),has:(e,t)=>e._hasElement(t),ownKeys:e=>e._getKeys(),getOwnPropertyDescriptor:(e,t)=>{if(e._hasElement(t))return{enumerable:!0,configurable:!0,value:e._getElement(t)}}})}_getElement(e){if("string"!=typeof e)return this._warn("Invalid element property type: "+typeof e),null;if(this.cache.has(e)){const t=this.cache.get(e);if(t&&t.nodeType===Node.ELEMENT_NODE&&document.contains(t))return this.stats.hits++,this._enhanceElementWithUpdate(t);this.cache.delete(e)}const t=document.getElementById(e);return t?(this._addToCache(e,t),this.stats.misses++,this._enhanceElementWithUpdate(t)):(this.stats.misses++,this.options.enableLogging&&this._warn(`Element with id '${e}' not found`),null)}_hasElement(e){if("string"!=typeof e)return!1;if(this.cache.has(e)){const t=this.cache.get(e);if(t&&t.nodeType===Node.ELEMENT_NODE&&document.contains(t))return!0;this.cache.delete(e)}return!!document.getElementById(e)}_getKeys(){const e=document.querySelectorAll("[id]");return Array.from(e).map(e=>e.id).filter(e=>e)}_addToCache(e,t){if(this.cache.size>=this.options.maxCacheSize){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t),this.stats.cacheSize=this.cache.size,this.weakCache.set(t,{id:e,cachedAt:Date.now(),accessCount:1})}_initMutationObserver(){const e=this._debounce(e=>{this._processMutations(e)},this.options.debounceDelay);this.observer=new MutationObserver(e),document.body?this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["id"],attributeOldValue:!0}):document.addEventListener("DOMContentLoaded",()=>{document.body&&!this.isDestroyed&&this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["id"],attributeOldValue:!0})})}_processMutations(e){if(this.isDestroyed)return;const t=new Set,s=new Set;e.forEach(e=>{if(e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){e.id&&t.add(e.id);try{(e.querySelectorAll?e.querySelectorAll("[id]"):[]).forEach(e=>{e.id&&t.add(e.id)})}catch(e){}}}),e.removedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){e.id&&s.add(e.id);try{(e.querySelectorAll?e.querySelectorAll("[id]"):[]).forEach(e=>{e.id&&s.add(e.id)})}catch(e){}}}),"attributes"===e.type&&"id"===e.attributeName){const i=e.oldValue,n=e.target.id;i&&i!==n&&s.add(i),n&&n!==i&&t.add(n)}}),t.forEach(e=>{const t=document.getElementById(e);t&&this._addToCache(e,t)}),s.forEach(e=>{this.cache.delete(e)}),this.stats.cacheSize=this.cache.size}_scheduleCleanup(){this.options.autoCleanup&&!this.isDestroyed&&(this.cleanupTimer=setTimeout(()=>{this._performCleanup(),this._scheduleCleanup()},this.options.cleanupInterval))}_performCleanup(){if(this.isDestroyed)return;this.cache.size;const e=[];for(const[t,s]of this.cache)s&&s.nodeType===Node.ELEMENT_NODE&&document.contains(s)&&s.id===t||e.push(t);e.forEach(e=>this.cache.delete(e)),this.stats.cacheSize=this.cache.size,this.stats.lastCleanup=Date.now(),this.options.enableLogging&&e.length>0&&this._log(`Cleanup completed. Removed ${e.length} stale entries.`)}_debounce(e,t){let s;return(...i)=>{clearTimeout(s),s=setTimeout(()=>e.apply(this,i),t)}}_log(e){this.options.enableLogging&&console.log(`[Elements] ${e}`)}_warn(e){this.options.enableLogging&&console.warn(`[Elements] ${e}`)}_enhanceElementWithUpdate(e){if(!e||e._hasUpdateMethod)return e;if(t&&t.enhanceElementWithUpdate)return t.enhanceElementWithUpdate(e);try{Object.defineProperty(e,"update",{value:(t={})=>{if(!t||"object"!=typeof t)return console.warn("[DOM Helpers] .update() called with invalid updates object"),e;try{Object.entries(t).forEach(([t,s])=>{"style"!==t||"object"!=typeof s||null===s?"function"!=typeof e[t]?t in e?e[t]=s:"string"!=typeof s&&"number"!=typeof s||e.setAttribute(t,s):Array.isArray(s)?e[t](...s):e[t](s):Object.entries(s).forEach(([t,s])=>{null!=s&&(e.style[t]=s)})})}catch(e){console.warn(`[DOM Helpers] Error in .update(): ${e.message}`)}return e},writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(e,"_hasUpdateMethod",{value:!0,writable:!1,enumerable:!1,configurable:!1})}catch(t){e.update=(t={})=>{if(!t||"object"!=typeof t)return console.warn("[DOM Helpers] .update() called with invalid updates object"),e;try{Object.entries(t).forEach(([t,s])=>{"style"!==t||"object"!=typeof s||null===s?"function"!=typeof e[t]?t in e?e[t]=s:"string"!=typeof s&&"number"!=typeof s||e.setAttribute(t,s):Array.isArray(s)?e[t](...s):e[t](s):Object.entries(s).forEach(([t,s])=>{null!=s&&(e.style[t]=s)})})}catch(e){console.warn(`[DOM Helpers] Error in .update(): ${e.message}`)}return e},e._hasUpdateMethod=!0}return e}getStats(){return{...this.stats,hitRate:this.stats.hits/(this.stats.hits+this.stats.misses)||0,uptime:Date.now()-this.stats.lastCleanup}}clearCache(){this.cache.clear(),this.stats.cacheSize=0,this._log("Cache cleared manually")}destroy(){this.isDestroyed=!0,this.observer&&(this.observer.disconnect(),this.observer=null),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=null),this.cache.clear(),this._log("Elements helper destroyed")}isCached(e){return this.cache.has(e)}getCacheSnapshot(){return Array.from(this.cache.keys())}destructure(...e){const t={},s=[];return e.forEach(e=>{const i=this.Elements[e];i?t[e]=i:(s.push(e),t[e]=null)}),s.length>0&&this.options.enableLogging&&this._warn(`Missing elements during destructuring: ${s.join(", ")}`),t}getRequired(...e){const t=this.destructure(...e),s=e.filter(e=>!t[e]);if(s.length>0)throw new Error(`Required elements not found: ${s.join(", ")}`);return t}async waitFor(...e){const t=Date.now();for(;Date.now()-t<5e3;){const t=this.destructure(...e);if(e.every(e=>t[e]))return t;await new Promise(e=>setTimeout(e,100))}throw new Error(`Timeout waiting for elements: ${e.join(", ")}`)}get(e,t=null){return this.Elements[e]||t}exists(e){return!!this.Elements[e]}getMultiple(...e){return this.destructure(...e)}setProperty(e,t,s){const i=this.Elements[e];return!(!i||!(t in i)||(i[t]=s,0))}getProperty(e,t,s=void 0){const i=this.Elements[e];return i&&t in i?i[t]:s}setAttribute(e,t,s){const i=this.Elements[e];return!!i&&(i.setAttribute(t,s),!0)}getAttribute(e,t,s=null){const i=this.Elements[e];return i&&i.getAttribute(t)||s}}const s=new ProductionElementsHelper({enableLogging:!1,autoCleanup:!0,cleanupInterval:3e4,maxCacheSize:1e3}),Elements=s.Elements;Elements.helper=s,Elements.stats=()=>s.getStats(),Elements.clear=()=>s.clearCache(),Elements.destroy=()=>s.destroy(),Elements.destructure=(...e)=>s.destructure(...e),Elements.getRequired=(...e)=>s.getRequired(...e),Elements.waitFor=(...e)=>s.waitFor(...e),Elements.isCached=e=>s.isCached(e),Elements.get=(e,t)=>s.get(e,t),Elements.exists=e=>s.exists(e),Elements.getMultiple=(...e)=>s.getMultiple(...e),Elements.setProperty=(e,t,i)=>s.setProperty(e,t,i),Elements.getProperty=(e,t,i)=>s.getProperty(e,t,i),Elements.setAttribute=(e,t,i)=>s.setAttribute(e,t,i),Elements.getAttribute=(e,t,i)=>s.getAttribute(e,t,i),Elements.configure=e=>(Object.assign(s.options,e),Elements),"undefined"!=typeof module&&module.exports?module.exports={Elements:Elements,ProductionElementsHelper:ProductionElementsHelper}:"function"==typeof define&&define.amd?define([],function(){return{Elements:Elements,ProductionElementsHelper:ProductionElementsHelper}}):(e.Elements=Elements,e.ProductionElementsHelper=ProductionElementsHelper),"undefined"!=typeof window&&window.addEventListener("beforeunload",()=>{s.destroy()})}("undefined"!=typeof window?window:"undefined"!=typeof global?global:this);